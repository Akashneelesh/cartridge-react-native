---
phase: 03-wallet-connection
plan: 02
type: execute
---

<objective>
Build wallet connection UI with connect button and address display.

Purpose: Provide user interface for connecting/disconnecting Cartridge wallet and displaying connected address.
Output: Updated App.tsx with wallet UI section showing connect button or connected address.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-wallet-connection/DISCOVERY.md

# Prior plan context:
@.planning/phases/03-wallet-connection/03-01-SUMMARY.md (will exist after 03-01 executes)

# Key files:
@App.tsx
@src/hooks/useWallet.ts
@src/config/wallet.ts

**Tech stack available:** starknet.js v9, @cartridge/controller, expo-web-browser, expo-linking
**Established patterns:**
- Counter display with loading/error states in App.tsx
- TouchableOpacity for buttons with consistent styling
- StyleSheet for component styles

**UI pattern from PROJECT.md:** "Single-screen app with counter prominently centered, increment/decrement buttons flanking, wallet connection in header or below counter"
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add wallet connection UI to App.tsx</name>
  <files>App.tsx</files>
  <action>Update App.tsx to integrate wallet connection UI:

**Import useWallet hook:**
```typescript
import { useWallet } from './src/hooks/useWallet';
```

**Add wallet state in component:**
```typescript
const { address, isConnecting, error: walletError, connect, disconnect, isConnected } = useWallet();
```

**Add wallet UI section (above or below counter, per PROJECT.md):**

When NOT connected:
- "Connect Wallet" button (TouchableOpacity)
- Show isConnecting state with ActivityIndicator or disabled button text "Connecting..."
- Show walletError if present

When connected:
- Display truncated address (e.g., "0x1234...5678")
- "Disconnect" button

**Styling:**
- Match existing button style (refreshButton pattern)
- Address display: monospace font if available, or use default with clear formatting
- Keep layout balanced with counter in center

**Helper function for address truncation:**
```typescript
const truncateAddress = (addr: string) =>
  `${addr.slice(0, 6)}...${addr.slice(-4)}`;
```

Do NOT modify existing counter functionality - only add wallet section.</action>
  <verify>TypeScript compiles (npx tsc --noEmit), app renders with new UI elements</verify>
  <done>App.tsx has wallet section with connect/disconnect button and address display, existing counter UI preserved</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete wallet connection UI with connect button and address display</what-built>
  <how-to-verify>
    1. Run: npx expo start --ios
    2. Open app in iOS Simulator
    3. Verify UI layout:
       - Counter value still displays and refreshes
       - "Connect Wallet" button is visible
       - Button styling matches app theme
    4. Test connect flow:
       - Tap "Connect Wallet"
       - Should show connecting state
       - May open browser/webview for Cartridge auth
       - Note: Full auth flow depends on Cartridge's RN support
    5. If connected:
       - Verify address displays in truncated format
       - Verify "Disconnect" button appears
       - Tap disconnect, verify returns to connect state
    6. Test error handling:
       - If connection fails, error message should display
  </how-to-verify>
  <resume-signal>Type "approved" if wallet UI works correctly, or describe any issues with the flow</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] App.tsx imports and uses useWallet hook
- [ ] Connect button visible when not connected
- [ ] Connecting state shows loading indicator
- [ ] Connected state shows truncated address
- [ ] Disconnect button works
- [ ] Error states display properly
- [ ] Counter functionality still works
- [ ] TypeScript compiles without errors
</verification>

<success_criteria>

- All tasks completed
- Wallet UI integrated into App.tsx
- Connect/disconnect flow functional
- Address displays when connected
- No regression in counter read functionality
- Phase 3 complete
</success_criteria>

<output>
After completion, create `.planning/phases/03-wallet-connection/03-02-SUMMARY.md` following the summary template.

Include in summary:
- Note any issues with Cartridge Controller in React Native environment
- Document if WebView or system browser was used for auth
- Phase 3 complete status
</output>
