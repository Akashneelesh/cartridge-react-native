---
phase: 02-counter-read
plan: 01
type: execute
---

<objective>
Display counter value from Starknet contract with loading and error states.

Purpose: Enable read-only interaction with deployed counter contract, establishing the RpcProvider and Contract patterns for subsequent phases.
Output: Working counter display with loading spinner, error handling, and manual refresh capability.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-02-SUMMARY.md

# Key files from Phase 1:
@App.tsx
@index.ts
@metro.config.js

**Tech stack available:**
- expo@54, react@19, react-native@0.81
- starknet@9.2.1 (RpcProvider, Contract, constants)
- react-native-get-random-values (polyfill configured)

**Established patterns:**
- Polyfill import first in index.ts
- RpcProvider instantiation works (verified in Phase 1)

**Contract details (from PROJECT.md):**
- Address: `0x075410d36a0690670137c3d15c01fcfa2ce094a4d0791dc769ef18c1c423a7f8`
- Network: Starknet Sepolia
- Function: `get_counter()` returns u128

**starknet.js patterns (from discovery):**
```typescript
import { RpcProvider, Contract, constants } from 'starknet';

// Provider for Sepolia
const provider = new RpcProvider({
  nodeUrl: constants.NetworkName.SN_SEPOLIA
});

// Read-only contract
const contract = new Contract(abi, address, provider);
const value = await contract.get_counter();
```
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Starknet provider and contract configuration</name>
  <files>src/config/starknet.ts, src/types/counter.ts</files>
  <action>
Create src/ directory structure if needed.

1. Create `src/types/counter.ts`:
   - Define minimal ABI type for get_counter function (view function returning u128)
   - Export ABI as const array

2. Create `src/config/starknet.ts`:
   - Import RpcProvider, Contract, constants from 'starknet'
   - Create provider using `constants.NetworkName.SN_SEPOLIA`
   - Define CONTRACT_ADDRESS constant: `0x075410d36a0690670137c3d15c01fcfa2ce094a4d0791dc769ef18c1c423a7f8`
   - Create and export getCounterContract() function that returns Contract instance
   - Export a getCounterValue() async function that:
     - Gets contract instance
     - Calls get_counter()
     - Returns the value as bigint (starknet.js returns bigint for u128)

Note: Do NOT use react-native-get-random-values import in these files - that polyfill is already imported first in index.ts. The starknet imports will work because the polyfill loads before App.tsx.
  </action>
  <verify>TypeScript compiles without errors: `npx tsc --noEmit`</verify>
  <done>src/config/starknet.ts exports getCounterValue() function, src/types/counter.ts has ABI definition, no TypeScript errors</done>
</task>

<task type="auto">
  <name>Task 2: Build counter display UI with states</name>
  <files>App.tsx</files>
  <action>
Update App.tsx to display counter with loading/error states:

1. Import getCounterValue from src/config/starknet
2. Add state:
   - `counter: bigint | null` (null = loading or error)
   - `loading: boolean`
   - `error: string | null`
3. Create `fetchCounter` async function:
   - Set loading true, error null
   - Try: call getCounterValue(), set counter, set loading false
   - Catch: set error to message, set loading false
4. useEffect to call fetchCounter on mount
5. Update UI:
   - Keep existing title "Starknet Counter"
   - Show ActivityIndicator when loading
   - Show error text (red) when error exists
   - Show counter value (large text) when loaded successfully
   - Add TouchableOpacity "Refresh" button that calls fetchCounter
   - Style: centered layout, counter value prominent (fontSize 48), refresh button below

Use React Native's ActivityIndicator for loading state (no external packages).
Format counter display as plain number (counter.toString()).
  </action>
  <verify>
1. `npx tsc --noEmit` passes
2. `npx expo start` launches Metro bundler
3. On device/simulator: app shows loading state, then counter value (or error if network issue)
  </verify>
  <done>Counter value displays on launch, loading spinner shows during fetch, error message shows on failure, refresh button re-fetches value</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npx tsc --noEmit` passes without errors
- [ ] Metro bundler starts with `npx expo start`
- [ ] App loads on iOS simulator/device
- [ ] Counter value fetches and displays from Sepolia contract
- [ ] Loading state visible during fetch
- [ ] Refresh button triggers new fetch
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors
- Counter reads from contract address 0x075410d36a0690670137c3d15c01fcfa2ce094a4d0791dc769ef18c1c423a7f8
- Loading and error states work correctly
- Refresh button functional
</success_criteria>

<output>
After completion, create `.planning/phases/02-counter-read/02-01-SUMMARY.md` following the summary template with frontmatter including:
- subsystem: contract-read
- requires: [01-02]
- provides: [getCounterValue function, counter display UI]
- affects: [03-wallet-connection, 04-counter-write]
- key-files created/modified
- key-decisions made
</output>
