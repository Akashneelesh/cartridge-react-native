---
phase: 05-polish
plan: 01
type: execute
---

<objective>
Add transaction status modal with pending, confirmed, and failed states.

Purpose: Provide clear visual feedback during blockchain transactions instead of inline text.
Output: Modal component showing transaction progress with dismiss capability.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./05-01-SUMMARY.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@App.tsx
@src/hooks/useSessionManager.ts
@src/config/constants.ts

**Prior context:**
- Phase 4 implemented increment/decrement with basic inline status
- Transaction execution via `executeTransaction` returns tx hash (string)
- Current state: txPending boolean, txError string for inline display
- Uses React Native Modal, TouchableOpacity, ActivityIndicator

**What exists:**
- handleTransaction in App.tsx calls executeTransaction
- Inline "Transaction pending..." text with ActivityIndicator
- Inline txError display

**What's needed:**
- Modal overlay for transaction states
- Track transaction hash from executeTransaction
- Show pending (spinning), success (hash + link), failed (error + retry)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TransactionModal component</name>
  <files>src/components/TransactionModal.tsx</files>
  <action>
Create a reusable modal component for transaction status. Structure:
- Props: visible (boolean), status ('pending' | 'success' | 'error'), txHash (string | null), error (string | null), onDismiss (callback), onRetry (callback)
- Pending state: ActivityIndicator with "Transaction pending..." text, Cancel button to dismiss
- Success state: Checkmark icon (use Text with Unicode checkmark), "Transaction confirmed" text, txHash displayed (truncated), "View on Voyager" button that opens Linking.openURL, Done button to dismiss
- Error state: X icon (use Text with Unicode X), error message, Retry and Close buttons

Use React Native Modal with transparent background overlay.
Voyager URL format: https://sepolia.voyager.online/tx/{txHash}

Avoid: Don't use external icon libraries. Use Unicode symbols for icons (checkmark: "\u2714", X: "\u2716").
  </action>
  <verify>TypeScript compiles: npx tsc --noEmit</verify>
  <done>TransactionModal.tsx exists with pending/success/error states, proper props interface</done>
</task>

<task type="auto">
  <name>Task 2: Integrate modal into App.tsx transaction flow</name>
  <files>App.tsx</files>
  <action>
Update transaction handling to use modal:
1. Add state: txStatus ('idle' | 'pending' | 'success' | 'error'), txHash (string | null)
2. Import TransactionModal component
3. Update handleTransaction:
   - Set txStatus='pending' before executeTransaction
   - On success: set txStatus='success', store txHash from result
   - On error: set txStatus='error', store error message
4. Add modal handlers:
   - onDismiss: reset txStatus to 'idle', clear txHash and txError
   - onRetry: re-run the last transaction (store lastMethod in state)
5. Render TransactionModal with visible={txStatus !== 'idle'}
6. Remove inline txPending/txError displays (replaced by modal)
7. After success dismiss, auto-refresh counter (already happens)

Keep existing styles, add modal visible when transaction in progress.
  </action>
  <verify>Run app: npx expo start, connect wallet, tap +/-, modal appears during transaction</verify>
  <done>Modal shows for pending/success/error states, can dismiss and retry</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Transaction status modal with pending, success, and error states</what-built>
  <how-to-verify>
    1. Run: npx expo start
    2. Connect wallet (Cartridge)
    3. Tap + button to increment
    4. Verify: Modal appears with spinner and "Transaction pending..."
    5. Wait for transaction to complete
    6. Verify: Modal shows success with transaction hash
    7. Tap "View on Voyager" - verify browser opens correct URL
    8. Tap "Done" - modal dismisses, counter refreshed
    9. Test error case: disconnect wallet, tap + while disconnected
    10. Verify: Modal shows error with retry option
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] TransactionModal component exists and compiles
- [ ] Modal appears during transactions
- [ ] Pending state shows spinner
- [ ] Success state shows tx hash and Voyager link
- [ ] Error state shows message and retry option
- [ ] No TypeScript errors
</verification>

<success_criteria>
- All tasks completed
- Modal replaces inline transaction status
- Voyager links work correctly
- User can dismiss modal and retry failed transactions
</success_criteria>

<output>
After completion, create `.planning/phases/05-polish/05-01-SUMMARY.md`
</output>
