---
phase: 05-polish
plan: 02
type: execute
---

<objective>
Add graceful error handling throughout the app with user-friendly messages.

Purpose: Improve error UX with clear messages and recovery options.
Output: Consistent error handling patterns across wallet, counter, and transaction flows.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./05-02-SUMMARY.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@App.tsx
@src/hooks/useSessionManager.ts
@src/config/starknet.ts

**Prior context (from 05-01):**
- TransactionModal handles tx errors with retry
- Basic error display exists for counter fetch and wallet

**Current error handling:**
- Counter fetch: shows raw error message
- Wallet connection: shows error string from hook
- Transaction: handled by modal (from 05-01)

**What's needed:**
- User-friendly error messages (not raw exceptions)
- Error recovery hints
- Consistent error styling
- Network error detection with retry prompts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create error message utility</name>
  <files>src/utils/errorMessages.ts</files>
  <action>
Create utility to convert technical errors to user-friendly messages:

```typescript
export function getUserFriendlyError(error: unknown, context: 'counter' | 'wallet' | 'transaction'): string
```

Mappings:
- Network/fetch errors: "Unable to connect. Check your internet connection."
- Contract errors: "Smart contract error. Please try again."
- Wallet connection cancelled: "Connection cancelled."
- Wallet errors: "Wallet connection failed. Please try again."
- Transaction rejected: "Transaction was rejected."
- Transaction failed: "Transaction failed. Please try again."
- Unknown: "Something went wrong. Please try again."

Check error.message for keywords: "network", "fetch", "timeout", "cancelled", "rejected", "contract".

Keep it simple - no external dependencies.
  </action>
  <verify>TypeScript compiles: npx tsc --noEmit</verify>
  <done>errorMessages.ts exports getUserFriendlyError function</done>
</task>

<task type="auto">
  <name>Task 2: Apply error utility throughout app</name>
  <files>App.tsx, src/hooks/useSessionManager.ts</files>
  <action>
Update error handling to use friendly messages:

1. In App.tsx fetchCounter catch block:
   - Import getUserFriendlyError
   - Replace raw error with getUserFriendlyError(err, 'counter')

2. In App.tsx handleTransaction catch block (if still inline, otherwise modal handles):
   - Use getUserFriendlyError(err, 'transaction')

3. In useSessionManager.ts connect catch block:
   - Import getUserFriendlyError
   - Use getUserFriendlyError(error, 'wallet') for setState error

4. Add retry hint below counter error:
   - Show "Tap Refresh to try again" below error message
   - Style: lighter gray, smaller font

Keep TransactionModal error handling as-is (passes through to modal).
  </action>
  <verify>Run app offline, verify friendly error messages appear</verify>
  <done>All error messages are user-friendly, retry hints displayed</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>User-friendly error messages across app</what-built>
  <how-to-verify>
    1. Run: npx expo start
    2. Turn off WiFi/network
    3. Tap Refresh - verify friendly "Unable to connect" message
    4. Verify retry hint appears below error
    5. Turn network back on, tap Refresh - counter loads
    6. Try to connect wallet, cancel mid-flow
    7. Verify "Connection cancelled" message (not raw error)
    8. Connect wallet, trigger a transaction error (if possible)
    9. Verify error in modal is readable
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] errorMessages.ts utility exists
- [ ] Counter errors show friendly messages
- [ ] Wallet errors show friendly messages
- [ ] Retry hints displayed where appropriate
- [ ] No TypeScript errors
</verification>

<success_criteria>
- All tasks completed
- No raw technical errors shown to users
- Clear recovery hints provided
- Phase 5 complete
</success_criteria>

<output>
After completion, create `.planning/phases/05-polish/05-02-SUMMARY.md`:

# Phase 5 Plan 2: Error Handling Summary

**[One-liner about what was accomplished]**

## Accomplishments
- [Key outcomes]

## Files Created/Modified
- [Files and changes]

## Decisions Made
- [Any decisions]

## Issues Encountered
- [Problems and resolutions]

## Next Phase Readiness
- Phase 5 complete
- All project requirements implemented
- App ready for testing/demo
</output>
