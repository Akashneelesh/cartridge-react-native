---
phase: 01-foundation
plan: 02
type: execute
---

<objective>
Configure crypto polyfills for starknet.js React Native compatibility.

Purpose: Enable starknet.js to work in React Native by polyfilling Node.js crypto APIs.
Output: Working polyfill configuration where starknet.js can be imported without errors.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation/DISCOVERY.md
@.planning/phases/01-foundation/01-01-SUMMARY.md (if exists)
@package.json
@metro.config.js (if exists)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install polyfill packages</name>
  <files>package.json</files>
  <action>
    Install the crypto polyfill package:

    ```bash
    npm install react-native-get-random-values
    ```

    This package provides:
    - `crypto.getRandomValues()` polyfill required by starknet.js
    - Works with Metro bundler out of the box

    Note: We're using the simple polyfill approach, not react-native-quick-crypto,
    since this is a demo app and the simpler solution is sufficient.
  </action>
  <verify>
    - package.json includes "react-native-get-random-values"
    - `npm ls react-native-get-random-values` shows installed
  </verify>
  <done>Polyfill package installed</done>
</task>

<task type="auto">
  <name>Task 2: Configure Metro bundler and entry point</name>
  <files>metro.config.js, index.js</files>
  <action>
    **1. Create or update metro.config.js:**

    ```javascript
    const { getDefaultConfig } = require('expo/metro-config');

    const config = getDefaultConfig(__dirname);

    // Polyfill crypto for starknet.js
    config.resolver.extraNodeModules = {
      ...config.resolver.extraNodeModules,
      crypto: require.resolve('react-native-get-random-values'),
    };

    module.exports = config;
    ```

    **2. Create index.js entry point with polyfill import:**

    ```javascript
    // Polyfills must be imported FIRST, before any other imports
    import 'react-native-get-random-values';

    // Then import expo entry
    import 'expo-router/entry';
    ```

    **Important:** The polyfill import MUST be the first line. If it's not first,
    crypto operations may fail silently or throw errors.

    **3. Update package.json main field (if needed):**

    If package.json has `"main": "expo-router/entry"`, change to `"main": "index.js"`.
    If it has `"main": "node_modules/expo/AppEntry.js"` (older template), also change to `"index.js"`.
  </action>
  <verify>
    - metro.config.js exists with crypto polyfill config
    - index.js exists with polyfill import as first line
    - package.json main points to index.js
  </verify>
  <done>Metro config and entry point configured with polyfills</done>
</task>

<task type="auto">
  <name>Task 3: Verify starknet.js imports work</name>
  <files>app/index.tsx or App.tsx</files>
  <action>
    Update the main app component to import starknet.js and verify it loads:

    **In app/index.tsx (if using expo-router) or App.tsx:**

    ```typescript
    import { Text, View, StyleSheet } from 'react-native';
    import { RpcProvider, constants } from 'starknet';

    export default function App() {
      // Test that starknet.js loads without crashing
      const provider = new RpcProvider({
        nodeUrl: constants.NetworkName.SN_SEPOLIA,
      });

      return (
        <View style={styles.container}>
          <Text style={styles.title}>Starknet Counter</Text>
          <Text>Provider initialized: {provider ? 'Yes' : 'No'}</Text>
        </View>
      );
    }

    const styles = StyleSheet.create({
      container: {
        flex: 1,
        justifyContent: 'center',
        alignItems: 'center',
        backgroundColor: '#fff',
      },
      title: {
        fontSize: 24,
        fontWeight: 'bold',
        marginBottom: 20,
      },
    });
    ```

    This verifies:
    1. react-native-get-random-values polyfill is working
    2. starknet.js can be imported
    3. RpcProvider can be instantiated
  </action>
  <verify>
    Run `npx expo start` and:
    - App loads without crypto-related errors
    - Screen shows "Starknet Counter" title
    - Screen shows "Provider initialized: Yes"
  </verify>
  <done>starknet.js imports and RpcProvider instantiation work without errors</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] react-native-get-random-values installed
- [ ] metro.config.js has crypto polyfill
- [ ] index.js imports polyfill first
- [ ] App imports starknet.js without errors
- [ ] `npx expo start` runs and app displays
</verification>

<success_criteria>
- Polyfill configuration complete
- starknet.js can be imported and used
- RpcProvider can be instantiated
- No crypto-related runtime errors
- Phase 1 complete: Foundation ready for Phase 2
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-02-SUMMARY.md`

Since this is the final plan of Phase 1, the summary should include:
- "Phase 1 complete, ready for Phase 2: Counter Read"
</output>
